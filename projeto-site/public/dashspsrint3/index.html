<!doctype html>
<html>

<head>
	<title>Flow</title>
	<link rel="icon" href="imagem/logo.png" type="imagem/icon">
	<script src="https://kit.fontawesome.com/508f88ea40.js" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
	<script src="https://www.chartjs.org/dist/2.9.3/Chart.min.js"></script>
	<!--importando a biblioteca chartJS-->
	<script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
	<script src="https://cdn.zingchart.com/zingchart.min.js"></script>
	<!--importando a biblioteca zingchart-->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<script src="http://www.chartjs.org/samples/latest/utils.js"></script>
	<link rel="stylesheet" href="./css/style.css">
	<script src="https://cdn.zingchart.com/zingchart.min.js"></script>
	<script type="text/javascript" src="../funcoes.js"></script>
</head>
<!-- ****************************NAV********************************** -->
<body>
		<div id="caixaMapa">
				<div id="modalMapa">
					<div id="fechamapa" onclick="fechamapa()">X</div>
					<div id="heatmapContainerWrapper">
		
						<div id="heatmapContainer">
						</div>
					</div>
		
				</div>
			</div>
	<nav id="menu" class="menu">

		<div class="item-menu" id="logo">
			<h1 >Flow</h1>
		</div>

		<div id="elementPai" class="pai">
		<a href="./relatórios.html" class="linkmenu">
		<div id="div_icon1" class="item-menu" id="active">
			<i class="material-icons icon_nav">dashboard</i>
			<p class="letra" id="frase_dash_nav">Dashboard</p>
		</div>
	</a>
		<a href="./relatórios.html" class="linkmenu">
		<div id="div_icon2" class="item-menu">
			
			<i class="material-icons icon_nav">description</i>
			<p class="letra" id="frase_rel_nav">Relatórios</p>
		
		</div>
	</a>

	<a href="help.html" class="linkmenu">
		<div id="div_icon3" class="item-menu">
			<i class="material-icons">drafts</i>
			<p class="letra" id="frase_contato_nav">Contato</p>
		</div>
	</a>

	<a href="../synergy.html" onclick="logoff()">
		<div id="div_icon4" class="item-menu">
			<i class="material-icons">exit_to_app</i>
			<p class="letra" id="frase_contato_goout">Sair</p>
		</div>
	</div>
	</a>
		<!-- BOTÕES PARA ABRIR E FECHAR MENU LATERAL -->
		<center>
		<div class="nav-seta">
			<i id="setaE" onclick="close_nav()" class="fas fa-chevron-left btn_menu"></i>
			<i id="setaD" onclick="open_nav()" style="display: none;" class="fas fa-chevron-right btn_menu"></i>
		</div>
	</center>
			
	</nav>

	<!-- **************************************************************** -->

	<section class="principal">
		<span id="Mapa" onclick="abremapa(),iniciamapa()"><i class="material-icons">map</i></span>
		
		<div id="dashboard">
			<div id="top">
				<div id="esquerda">
					<h1>Estação Paulista</h1>
					<p>Dados em tempo real</p>
				</div>
				<div id="esquerda">
					<b id="horario"></b>
					<b id="ano" style="margin-top:10px;"></b>
				</div>
			</div>

			<div id="grafico-topo">

				
				<div class="card" id="card1">
					<div class="container">
						<div class="text-card">
							<h4>Ala Leste</h4>
							<b>
								<span>Nivel de movimentação <p id="textodado1"></p> </span>

							</b>
							<a href="./setores/leste.html">
							<button class="botoescards">Ver mais informações</button>
						</a>
						</div>
						<i class="material-icons" style="color: blue">analytics</i>
					</div>
				</div>

				
				<div class="card" id="card2">
					<div class="container">
						<div class="text-card">
							<h4>Ala Norte</h4>
							<b>
								<span>Nivel de movimentação <p id="textodado2"></p> </span>

							</b>
							<a href="./setores/norte.html">
							<button class="botoescards">Ver mais informações</button>
						</a>
						</div>
						<i class="material-icons" style="color: green">analytics</i>
					</div>
				</div>

				
				<div class="card" id="card3">
					<div class="container">
						<div class="text-card">
							<h4>Ala Oeste</h4>
							<b>
								<span>Nivel de movimentação <p id="textodado3"></p> </span>

							</b>
							<a href="./setores/oeste.html">
							<button class="botoescards">Ver mais informações</button>
						</a>
						</div>
						<i class="material-icons" style="color: orange">analytics</i>
					</div>
				</div>


				
				<div class="card" id="card4">
					<div class="container">
						<div class="text-card">
							<h4>Ala sul</h4>
							<b>
								<span>Nivel de movimentação <p id="textodado4"></p> </span>

							</b>
							<a href="./setores/sul.html">
							<button class="botoescards" onclick="abremodal4()">Ver mais informações</button>
						</a>
						</div>

						<i class="material-icons" style="color: red">analytics</i>
					</div>
				</div>
			</div>
			<div id="grafico-baixo">
				<div id="grafico3">
					<section id="teste">
						<h4 class="media">Média: <label id='average'></label></h4>
						<h4 class="media-hora">Média por hora: <label id='averageHour'></label></h4>
						<div id="div-teste">
							<h4>Local: </h4>
							<select name="" id="corredor">
								<option value="">Selecione</option>
								<option value="">Corredor Leste</option>
								<option value="">Corredor Sul</option>
								<option value="">Escada 1</option>
							</select>

						</div>
					</section>
					<section id="grafico-section" style="width:100%">
						<canvas id="chart-switch"></canvas>
					</section>

				</div>

				<div id="grafico4">
					<div id="chart-area" style="transition: 0.5s;"></div>
				</div>
			</div>
		</div>




		<script type="text/javascript" src="graficopizza.js"></script>
		<script src="node_modules/heatmap.js/build/heatmap.js"></script>
		<script src="./javascript/setorleste.js"></script>
		<script src="./javascript/setornorte.js"></script>
		<script src="./javascript/setoroeste.js"></script>
		<script src="./javascript/setorsul.js"></script>
		<script src="./javascript/plotagrafico.js"></script>
		<script src="./javascript/mapa.js"></script>
		<script src="./javascript/acoesdash.js"></script>

		<script>
			//Função para FECHAR nav-menu
			
			function close_nav(){
				menu.style.width = '8%';
				setaE.style.display = 'none';
				setaD.style.display = 'block';

				div_icon1.style.marginLeft = '0';
				div_icon2.style.marginLeft = '0';
				div_icon3.style.marginLeft = '0';
				div_icon4.style.marginLeft = '0';
				logo.style.paddingLeft = '0';

				frase_rel_nav.style.opacity = '0';
				frase_dash_nav.style.opacity = '0';
				frase_contato_nav.style.opacity = '0';
				frase_contato_goout.style.opacity ='0';
				elementPai.style.marginLeft = '37%'
			}
			//Função para ABRIR nav-menu
			function open_nav(){
				menu.style.width = '13%';
				setaD.style.display = 'none';
				setaE.style.display = 'block';

				div_icon1.style.marginLeft = '0';
				div_icon2.style.marginLeft = '0';
				div_icon3.style.marginLeft = '0';
				div_icon4.style.marginLeft = '0';

				frase_rel_nav.style.opacity = '1';
				frase_dash_nav.style.opacity = '1';
				frase_contato_nav.style.opacity = '1';
				frase_contato_goout.style.opacity ='1';
				elementPai.style.marginLeft = '10%'
			}
			//Função para obter os dados de temperatura do server

			//Esse atributo dentro do contexto serve para saber qual foi o último índice processado, assim eliminado os outros elementos na
			//hora de montar/atualizar o gráfico

			this.time = 0;

			function get_data() {

				var http = new XMLHttpRequest();
				http.open('GET', 'http://localhost:3000/api', false);
				http.send(null);

				var obj = JSON.parse(http.responseText);




				if (obj.data.length == 0) {
					return;
				}

				var _lastIndexTemp = this.lastIndexTemp;
				this.lastIndexTemp = obj.data.length;
				listTemp = obj.data.slice(_lastIndexTemp);





			}







			//Second Graphic






			//Função para obter os dados de temperatura do server


			//Esse atributo dentro do contexto serve para saber qual foi o último índice processado, assim eliminado os outros elementos na
			//hora de montar/atualizar o gráfico




			//Thirty Graphic

			var context3 = document.getElementById("chart-switch").getContext("2d");
			context3.canvas.width = 1000;
			context3.canvas.height = 300;

			var switch_sensor = {
				type: 'line',
				data: {
					datasets: [{
						label: "Switch x Time",
						type: 'line',
						borderColor: ['#ae3f3f'],
						backgroundColor: ['#c97f7f']
					}]
				},
				options: {
					scales: {
						xAxes: [{
							//type: 'value',
							distribution: 'series',
							ticks: {
								beginAtZero: true
							}
						}],
						yAxes: [{
							scaleLabel: {
								display: true,
								labelString: 'Switch'
							},
							ticks: {
								beginAtZero: true
							}
						}]
					},
					animation: {
						duration: 0
					}
				}
			};

			var chartSwitch = new Chart(context3, switch_sensor);

			//Função para obter os dados de temperatura do server

			//Esse atributo dentro do contexto serve para saber qual foi o último índice processado, assim eliminado os outros elementos na
			//hora de montar/atualizar o gráfico
			this.lastIndexTempHumidity = 0;
			this.timeSwitch = 0;



			function get_switch() {

				var http = new XMLHttpRequest();
				http.open('GET', 'http://localhost:3000/api/switch', false);
				http.send(null);

				var obj = JSON.parse(http.responseText);
				// console.log(obj);
				if (obj.data.length == 0) {
					return;
				}

				var _lastIndexTemp = this.lastIndexTempSwitch;
				this.lastIndexTempSwitch = obj.data.length;
				listTemp = obj.data.slice(_lastIndexTemp);

				listTemp.forEach(data => {
					//Máximo de 60 itens exibidos no gráfico
					if (chartSwitch.data.labels.length == 10 && chartSwitch.data.datasets[0].data.length == 10) {
						chartSwitch.data.labels.shift();
						chartSwitch.data.datasets[0].data.shift();
					}

					chartSwitch.data.labels.push(this.time++);
					chartSwitch.data.datasets[0].data.push(parseFloat(data));
					chartSwitch.update();
				});

			}

			get_switch();




			function sendTemperature() {
				var http = new XMLHttpRequest();
				http.open('POST', 'http://localhost:3000/api/sendData');

				http.send();
				// testando(contador);
			}

			sendTemperature();






			setInterval(() => {

				get_data();

				get_switch();

				sendTemperature();

			}, 2000);


		</script>
</body>       

</html>